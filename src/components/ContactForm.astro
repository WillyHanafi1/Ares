---
const challenges = [
    { value: "cs", label: "Customer Service Kewalahan (Balas Chat Lama)" },
    { value: "admin", label: "Administrasi & Input Data Manual" },
    { value: "leads", label: "Manajemen Leads / Penjualan" },
    { value: "cost", label: "Ingin Efisiensi Biaya Operasional" },
    { value: "other", label: "Lainnya" },
];

// Country codes with flags and ISO codes
const countries = [
    { code: "62", iso: "ID", name: "Indonesia", flag: "ðŸ‡®ðŸ‡©" },
    { code: "1", iso: "US", name: "United States", flag: "ðŸ‡ºðŸ‡¸" },
    { code: "44", iso: "GB", name: "United Kingdom", flag: "ðŸ‡¬ðŸ‡§" },
    { code: "60", iso: "MY", name: "Malaysia", flag: "ðŸ‡²ðŸ‡¾" },
    { code: "65", iso: "SG", name: "Singapore", flag: "ðŸ‡¸ðŸ‡¬" },
    { code: "66", iso: "TH", name: "Thailand", flag: "ðŸ‡¹ðŸ‡­" },
    { code: "84", iso: "VN", name: "Vietnam", flag: "ðŸ‡»ðŸ‡³" },
    { code: "63", iso: "PH", name: "Philippines", flag: "ðŸ‡µðŸ‡­" },
    { code: "61", iso: "AU", name: "Australia", flag: "ðŸ‡¦ðŸ‡º" },
    { code: "81", iso: "JP", name: "Japan", flag: "ðŸ‡¯ðŸ‡µ" },
    { code: "82", iso: "KR", name: "South Korea", flag: "ðŸ‡°ðŸ‡·" },
    { code: "86", iso: "CN", name: "China", flag: "ðŸ‡¨ðŸ‡³" },
    { code: "91", iso: "IN", name: "India", flag: "ðŸ‡®ðŸ‡³" },
    { code: "49", iso: "DE", name: "Germany", flag: "ðŸ‡©ðŸ‡ª" },
    { code: "33", iso: "FR", name: "France", flag: "ðŸ‡«ðŸ‡·" },
    { code: "39", iso: "IT", name: "Italy", flag: "ðŸ‡®ðŸ‡¹" },
    { code: "34", iso: "ES", name: "Spain", flag: "ðŸ‡ªðŸ‡¸" },
    { code: "31", iso: "NL", name: "Netherlands", flag: "ðŸ‡³ðŸ‡±" },
    { code: "971", iso: "AE", name: "UAE", flag: "ðŸ‡¦ðŸ‡ª" },
    { code: "966", iso: "SA", name: "Saudi Arabia", flag: "ðŸ‡¸ðŸ‡¦" },
    { code: "90", iso: "TR", name: "Turkey", flag: "ðŸ‡¹ðŸ‡·" },
    { code: "7", iso: "RU", name: "Russia", flag: "ðŸ‡·ðŸ‡º" },
    { code: "55", iso: "BR", name: "Brazil", flag: "ðŸ‡§ðŸ‡·" },
    { code: "52", iso: "MX", name: "Mexico", flag: "ðŸ‡²ðŸ‡½" },
    { code: "27", iso: "ZA", name: "South Africa", flag: "ðŸ‡¿ðŸ‡¦" },
    { code: "234", iso: "NG", name: "Nigeria", flag: "ðŸ‡³ðŸ‡¬" },
    { code: "20", iso: "EG", name: "Egypt", flag: "ðŸ‡ªðŸ‡¬" },
    { code: "880", iso: "BD", name: "Bangladesh", flag: "ðŸ‡§ðŸ‡©" },
    { code: "92", iso: "PK", name: "Pakistan", flag: "ðŸ‡µðŸ‡°" },
    { code: "64", iso: "NZ", name: "New Zealand", flag: "ðŸ‡³ðŸ‡¿" },
];

// Get environment variables (with fallbacks)
const recaptchaSiteKey = import.meta.env.PUBLIC_RECAPTCHA_SITE_KEY || "";
---

<section id="kontak" class="relative py-24" data-recaptcha={recaptchaSiteKey}>
    <div class="mx-auto max-w-3xl px-6 lg:px-8">
        <div
            class="animate-on-scroll animate-scale glass-panel rounded-2xl p-8 md:p-12 relative overflow-visible"
        >
            <!-- Gradient overlay -->
            <div
                class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-primary/5 to-transparent pointer-events-none"
            >
            </div>

            <div class="relative z-10">
                <!-- Header -->
                <div class="text-center mb-10">
                    <h2
                        class="animate-on-scroll animate-from-bottom text-3xl font-bold tracking-tight text-gray-900 dark:text-white mb-4"
                    >
                        Konsultasi Potensi AI untuk Bisnis Anda (Gratis)
                    </h2>
                    <p
                        class="animate-on-scroll animate-from-bottom animate-delay-100 text-gray-600 dark:text-gray-400"
                    >
                        Isi formulir di bawah ini untuk berdiskusi dengan tim
                        ahli kami.
                    </p>
                </div>

                <!-- Form -->
                <form id="contact-form" class="space-y-6">
                    <!-- CSRF Token (hidden) -->
                    <input
                        type="hidden"
                        id="csrf-token"
                        name="csrf_token"
                        value=""
                    />

                    <!-- Name -->
                    <div
                        class="animate-on-scroll animate-from-left animate-delay-100"
                    >
                        <label
                            for="name"
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                            >Nama Lengkap</label
                        >
                        <input
                            type="text"
                            id="name"
                            name="name"
                            placeholder="Contoh: Budi Santoso"
                            maxlength="100"
                            class="block w-full rounded-lg border border-gray-300 dark:border-white/10 bg-white dark:bg-white/5 px-4 py-3 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all"
                        />
                    </div>

                    <!-- Business Name -->
                    <div
                        class="animate-on-scroll animate-from-right animate-delay-200"
                    >
                        <label
                            for="business"
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                            >Nama Bisnis / Perusahaan</label
                        >
                        <input
                            type="text"
                            id="business"
                            name="business"
                            placeholder="Contoh: Seriaflow Agency"
                            maxlength="150"
                            class="block w-full rounded-lg border border-gray-300 dark:border-white/10 bg-white dark:bg-white/5 px-4 py-3 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all"
                        />
                    </div>

                    <!-- WhatsApp with Country Code -->
                    <div
                        class="relative z-20 animate-on-scroll animate-from-left animate-delay-300"
                    >
                        <label
                            for="whatsapp"
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                        >
                            Nomor WhatsApp (Aktif) <span class="text-red-500"
                                >*</span
                            >
                        </label>
                        <div class="flex gap-2">
                            <!-- Custom Country Code Dropdown -->
                            <div
                                class="relative w-36 flex-shrink-0 z-10"
                                id="custom-country-dropdown"
                            >
                                <input
                                    type="hidden"
                                    name="country_code"
                                    id="hidden-country-code"
                                    value="62"
                                />

                                <button
                                    type="button"
                                    id="dropdown-trigger"
                                    class="flex w-full items-center justify-between rounded-lg border border-gray-300 dark:border-white/10 bg-white dark:bg-white/5 px-3 py-3 text-gray-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary transition-all text-sm"
                                >
                                    <span
                                        id="selected-display"
                                        class="flex items-center gap-2"
                                    >
                                        <img
                                            src="https://flagcdn.com/w40/id.png"
                                            width="20"
                                            height="15"
                                            alt="ID"
                                            class="rounded-sm"
                                        />
                                        <span>+62</span>
                                    </span>
                                    <span
                                        class="material-symbols-outlined text-sm text-gray-400"
                                        >expand_more</span
                                    >
                                </button>

                                <div
                                    id="dropdown-options"
                                    class="hidden absolute top-full left-0 mt-2 w-72 max-h-60 overflow-y-auto rounded-lg border border-gray-200 dark:border-white/10 bg-white dark:bg-[#0f0f25] shadow-xl z-50"
                                >
                                    <div
                                        class="sticky top-0 bg-white dark:bg-[#0f0f25] p-2 border-b border-gray-200 dark:border-white/10"
                                    >
                                        <input
                                            type="text"
                                            id="country-search"
                                            placeholder="Cari negara..."
                                            class="w-full bg-gray-100 dark:bg-white/5 text-gray-900 dark:text-white text-xs px-3 py-2 rounded border border-gray-200 dark:border-white/10 focus:outline-none focus:border-primary"
                                        />
                                    </div>

                                    <ul class="py-1">
                                        {
                                            countries.map((country) => (
                                                <li
                                                    class="country-option flex items-center gap-3 px-4 py-3 text-sm text-gray-600 dark:text-gray-300 hover:bg-primary/10 dark:hover:bg-primary/20 hover:text-primary dark:hover:text-white cursor-pointer transition-colors"
                                                    data-code={country.code}
                                                    data-iso={country.iso.toLowerCase()}
                                                    data-name={country.name}
                                                >
                                                    <img
                                                        src={`https://flagcdn.com/w40/${country.iso.toLowerCase()}.png`}
                                                        width="24"
                                                        height="18"
                                                        alt={country.iso}
                                                        class="rounded-sm"
                                                        loading="lazy"
                                                    />
                                                    <span class="font-mono text-gray-400">
                                                        +{country.code}
                                                    </span>
                                                    <span class="truncate flex-1 text-xs text-gray-500">
                                                        {country.name}
                                                    </span>
                                                </li>
                                            ))
                                        }
                                    </ul>
                                </div>
                            </div>

                            <input
                                type="tel"
                                id="whatsapp"
                                name="whatsapp"
                                placeholder="812xxxxxxxx"
                                required
                                minlength="8"
                                maxlength="15"
                                pattern="[0-9]*"
                                inputmode="numeric"
                                class="block w-full rounded-lg border border-gray-300 dark:border-white/10 bg-white dark:bg-white/5 px-4 py-3 text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all"
                            />
                            <p
                                id="phone-error"
                                class="hidden text-red-400 text-xs mt-1 absolute -bottom-5"
                            >
                                Nomor tidak valid (8-15 digit)
                            </p>
                        </div>
                    </div>

                    <!-- Challenge Dropdown -->
                    <div
                        class="animate-on-scroll animate-from-right animate-delay-400"
                    >
                        <label
                            for="challenge"
                            class="block text-sm font-medium text-gray-300 mb-2"
                            >Apa Tantangan Terbesar Anda?</label
                        >
                        <div class="relative">
                            <select
                                id="challenge"
                                name="challenge"
                                class="block w-full appearance-none rounded-lg border border-white/10 bg-white/5 px-4 py-3 text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all cursor-pointer"
                            >
                                <option value="" disabled selected
                                    >Pilih tantangan Anda</option
                                >
                                {
                                    challenges.map((item) => (
                                        <option value={item.value}>
                                            {item.label}
                                        </option>
                                    ))
                                }
                            </select>
                            <div
                                class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-400"
                            >
                                <span class="material-symbols-outlined text-sm"
                                    >expand_more</span
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button
                        type="submit"
                        id="submit-btn"
                        class="animate-on-scroll animate-from-bottom animate-delay-500 w-full flex items-center justify-center gap-2 rounded-lg bg-primary px-8 py-4 text-base font-bold text-white transition-all hover:bg-primary/90 hover:shadow-[0_0_20px_rgba(19,19,236,0.5)] mt-6"
                    >
                        <span class="material-symbols-outlined">send</span>
                        Kirim Data Saya
                    </button>

                    <!-- reCAPTCHA Notice -->
                    <p class="text-xs text-gray-500 text-center mt-4">
                        Dilindungi oleh reCAPTCHA.
                        <a
                            href="https://policies.google.com/privacy"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="underline hover:text-gray-400">Privacy</a
                        > &
                        <a
                            href="https://policies.google.com/terms"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="underline hover:text-gray-400">Terms</a
                        >
                    </p>
                </form>

                <!-- Success Message (hidden by default) -->
                <div id="success-message" class="hidden text-center py-8">
                    <div class="mb-6">
                        <span
                            class="material-symbols-outlined text-6xl text-green-400"
                            >check_circle</span
                        >
                    </div>
                    <h3 class="text-2xl font-bold text-white mb-3">
                        Data Berhasil Dikirim! ðŸŽ‰
                    </h3>
                    <p class="text-gray-400 mb-4">
                        Terima kasih telah menghubungi kami.<br />
                        Tim kami akan segera menghubungi Anda via <strong
                            class="text-green-400">WhatsApp</strong
                        >.
                    </p>
                    <p class="text-sm text-gray-500">
                        Biasanya kami merespon dalam waktu 1x24 jam.
                    </p>
                    <button
                        id="reset-form-btn"
                        class="mt-6 px-6 py-2 rounded-lg border border-white/10 text-gray-300 hover:bg-white/5 transition-all"
                    >
                        Kirim Data Lagi
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    select option {
        background-color: #13132b;
        color: white;
    }
    /* Hide reCAPTCHA badge - we show text notice instead */
    .grecaptcha-badge {
        visibility: hidden !important;
    }
    /* Custom scrollbar for dropdown */
    #dropdown-options::-webkit-scrollbar {
        width: 6px;
    }
    #dropdown-options::-webkit-scrollbar-track {
        background: #0f0f25;
    }
    #dropdown-options::-webkit-scrollbar-thumb {
        background: #333;
        border-radius: 3px;
    }
</style>

<!-- Load reCAPTCHA v3 Script -->
<script is:inline define:vars={{ recaptchaSiteKey }}>
    // Load reCAPTCHA script if site key exists
    if (recaptchaSiteKey && recaptchaSiteKey !== "your_site_key_here") {
        const script = document.createElement("script");
        script.src = `https://www.google.com/recaptcha/api.js?render=${recaptchaSiteKey}`;
        script.async = true;
        document.head.appendChild(script);
    }
</script>

<!-- External Contact Form Script -->
<script src="/scripts/contact-form.js" defer></script>
